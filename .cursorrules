# Cursor Project Rules for Luton Engineering Dashboard

This project follows the **Cursor Working Agreement** documented in `docs/cursor/working-agreement.md`.

## Core Rules

### Branch Management
- Always create a new branch for each task
- Branch naming: `feat/<area>-<goal>` or `fix/<area>-<bug>` or `cursor/<task-slug>` for Cursor-specific work
- Example: `feat/inventory-ssr-pagination`, `fix/dashboard-layout-bug`, `cursor/wa-audit-M1`

### Testing & Verification (Definition of "Done")
A change is **NOT DONE** until ALL of these pass:

1. ✅ `npm run typecheck` - TypeScript validation
2. ✅ `npm run lint` - ESLint validation
3. ✅ `npm run build` - Production build
4. ✅ `npm run test` - Unit tests (Vitest)
5. ✅ `npm run test:e2e:smoke` - Smoke E2E tests
6. ✅ `npm run ci:verify` - Full verification suite
7. ✅ Vercel preview deploys successfully
8. ✅ Documentation updated in `/docs/**` or marked **no-docs-needed**

### Pre-Commit/Pre-Push
- Pre-commit hook runs: `lint-staged` (ESLint on changed files)
- Pre-push hook runs: `npm run ci:verify` (full verification)
- **Never skip hooks** unless explicitly instructed

### Conventional Commits
All commits must follow Conventional Commits format:
- `feat:` - New features
- `fix:` - Bug fixes
- `test:` - Test additions/updates
- `refactor:` - Code refactoring
- `docs:` - Documentation changes
- `chore:` - Maintenance tasks

Example: `feat(inventory): add SSR pagination support`

### PR Requirements
Before opening a PR, ensure:
- [ ] `npm run ci:verify` passed locally
- [ ] Documentation updated or **no-docs-needed** label applied
- [ ] Vercel preview link included
- [ ] Tests added/updated (unit + E2E if applicable)
- [ ] PR template fully completed

### Phase Gates
Work in phases, pausing for review:
- **Phase 0:** Present 2+ approaches with pros/cons → wait for decision
- **Phase 1:** Create branch, scaffold files & config → pause for review
- **Phase 2:** Implement logic & tests → pause for review
- **Phase 3:** Add/adjust E2E smoke tests → pause for review
- **Phase 4:** Polish, update docs, open PR

### Technology Stack
- **Framework:** Next.js 15+ (App Router)
- **Language:** TypeScript (strict mode)
- **Styling:** Tailwind CSS
- **Database:** Supabase (PostgreSQL)
- **Testing:** Vitest (unit), Playwright (E2E)
- **Package Manager:** npm (on Windows) / pnpm (preferred for CI)
- **Linting:** ESLint
- **Formatting:** Prettier

### Key Commands
```bash
npm run dev              # Start dev server
npm run build            # Production build
npm run typecheck        # TypeScript check
npm run lint             # ESLint check
npm run test             # Unit tests
npm run test:watch       # Unit tests (watch mode)
npm run test:e2e         # All E2E tests
npm run test:e2e:smoke   # Smoke tests only
npm run ci:verify        # Full verification suite
```

### File Structure
- `/src/app/` - Next.js app routes
- `/src/components/` - React components
- `/src/lib/` - Utility libraries
- `/src/hooks/` - Custom React hooks
- `/tests/e2e/` - Playwright E2E tests
- `/scripts/` - Build & utility scripts
- `/docs/` - Project documentation

### Critical Principles
1. **Free-first mindset** - Use free/built-in tools
2. **No overkill** - Smallest solution that works
3. **Build once, use many** - Configuration-driven
4. **Zero regression** - Every change must be proven safe
5. **Consultative & iterative** - Propose options, deliver in phases

### Smoke Tests
Always ensure smoke tests cover:
- `/` (home page)
- `/dashboard/inventory` (main dashboard)
- Add new critical routes as they're developed

### Documentation Requirements
If ANY files under `app/**` or `src/**` are changed:
- Update relevant documentation in `/docs/**`
- OR explicitly mark PR with **no-docs-needed** label + rationale

### Final Checklist
At task completion, Cursor must report:
- ✅ Branch name created
- ✅ Output of `npm run ci:verify` (or failure logs)
- ✅ Vercel preview URL
- ✅ List of updated files (including `/docs/**`)
- ✅ Explanation if docs not needed

---

**Full Working Agreement:** See `docs/cursor/working-agreement.md` for complete details.

