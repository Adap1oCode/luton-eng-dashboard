===== HEADER =====
Repository: C:/Dev/luton-eng-dashboard
Branch: main
HEAD SHA: a0bc4d7
Date/Time: 2025-11-03 08:16:54 UTC

===== GIT STATUS =====
## main...origin/main
 M src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx
 M src/components/data-table/columns-menu.tsx
 M src/components/data-table/data-table-filters.tsx
 M src/components/data-table/data-table.tsx
 M src/components/data-table/use-column-resize.ts
 M src/components/data-table/use-saved-views.ts
 M src/components/forms/resource-view/resource-table-client.tsx
?? AUDIT_COLUMN_RESIZE.md
?? docs/diagnostics/
?? src/components/data-table/use-container-resize.ts

===== UNSTAGED DIFF =====
warning: in the working copy of 'src/components/data-table/columns-menu.tsx', LF will be replaced by CRLF the next time Git touches it
diff --git a/src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx b/src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx
index 1c2e3e2..0ee4c6a 100644
--- a/src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx
+++ b/src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx
@@ -7,6 +7,7 @@
  * This is needed because buildColumns() calls makeActionsColumn() which is client-only.
  * We can't pass functions from server to client components in Next.js.
  */
+import { useMemo } from "react";
 import ResourceTableClient from "@/components/forms/resource-view/resource-table-client";
 import type { BaseViewConfig } from "@/components/data-table/view-defaults";
 import type { StockAdjustmentRow } from "./stock-adjustments.config";
@@ -26,14 +27,16 @@ export function StockAdjustmentsTableClient({
   pageSize,
 }: StockAdjustmentsTableClientProps) {
   // Materialize columns in client context (where makeActionsColumn() can execute)
-  const viewConfigWithColumns: BaseViewConfig<StockAdjustmentRow> & {
-    columns?: any[];
-  } = {
-    ...stockAdjustmentsViewConfig,
-    columns: stockAdjustmentsViewConfig.buildColumns(),
-  };
-  // Remove buildColumns function since columns are materialized
-  delete (viewConfigWithColumns as any).buildColumns;
+  // Memoize to prevent unstable reference that triggers unnecessary recalculations
+  const viewConfigWithColumns = useMemo<BaseViewConfig<StockAdjustmentRow> & { columns?: any[] }>(() => {
+    const config = {
+      ...stockAdjustmentsViewConfig,
+      columns: stockAdjustmentsViewConfig.buildColumns(),
+    };
+    // Remove buildColumns function since columns are materialized
+    delete (config as any).buildColumns;
+    return config;
+  }, []); // Empty deps since buildColumns should be pure
 
   return (
     <ResourceTableClient
diff --git a/src/components/data-table/columns-menu.tsx b/src/components/data-table/columns-menu.tsx
index e57a8ea..1d3354c 100644
--- a/src/components/data-table/columns-menu.tsx
+++ b/src/components/data-table/columns-menu.tsx
@@ -20,6 +20,7 @@ interface ColumnsMenuProps {
   onShowAll: () => void;
   onHideAll: () => void;
   onResetOrder: () => void;
+  onResetWidths?: () => void;
   onDragStart: (e: React.DragEvent, columnId: string) => void;
   onDragOver: (e: React.DragEvent) => void;
   onDrop: (e: React.DragEvent, columnId: string) => void;
@@ -34,6 +35,7 @@ export const ColumnsMenu: React.FC<ColumnsMenuProps> = ({
   onShowAll,
   onHideAll,
   onResetOrder,
+  onResetWidths,
   onDragStart,
   onDragOver,
   onDrop,
@@ -51,6 +53,13 @@ export const ColumnsMenu: React.FC<ColumnsMenuProps> = ({
           Reset Order
         </Button>
       </div>
+      {onResetWidths && (
+        <div className="border-t border-gray-200 p-2 dark:border-gray-700">
+          <Button variant="outline" size="sm" onClick={onResetWidths} className="h-7 w-full text-xs">
+            Reset Widths
+          </Button>
+        </div>
+      )}
 
       <div className="max-h-64 space-y-1 overflow-y-auto p-1">
         {columns.map((column) => (
diff --git a/src/components/data-table/data-table-filters.tsx b/src/components/data-table/data-table-filters.tsx
index bb25f17..b23b3e9 100644
--- a/src/components/data-table/data-table-filters.tsx
+++ b/src/components/data-table/data-table-filters.tsx
@@ -25,7 +25,10 @@ export type FilterColumn = {
 
 type Props = {
   columns: FilterColumn[];
-  columnWidthsPct?: Record<string, number>; // for inline styles
+  // New px-based widths (preferred)
+  columnWidthsPx?: Record<string, number>;
+  // Legacy percentage widths
+  columnWidthsPct?: Record<string, number>;
   show?: boolean;
   search?: string;
   onSearchChange?: (v: string) => void;
@@ -36,7 +39,8 @@ type Props = {
 
 export function DataTableFilters({
   columns,
-  columnWidthsPct,
+  columnWidthsPx,
+  columnWidthsPct, // Legacy support
   show = true,
   search,
   onSearchChange,
@@ -57,7 +61,13 @@ export function DataTableFilters({
           <th
             key={c.id}
             className="bg-muted/50 border border-gray-200 p-2 text-left text-xs dark:border-gray-700"
-            style={columnWidthsPct?.[c.id] ? { width: `${columnWidthsPct[c.id]}%` } : undefined}
+            style={
+              columnWidthsPx?.[c.id]
+                ? { width: `${columnWidthsPx[c.id]}px` }
+                : columnWidthsPct?.[c.id]
+                  ? { width: `${columnWidthsPct[c.id]}%` }
+                  : undefined
+            }
           >
             {c.disableInput ? (
               <div />
diff --git a/src/components/data-table/data-table.tsx b/src/components/data-table/data-table.tsx
index 647886e..b0b04f5 100644
--- a/src/components/data-table/data-table.tsx
+++ b/src/components/data-table/data-table.tsx
@@ -71,11 +71,17 @@ interface TanStackDataTableProps<T = Record<string, unknown>> {
   sortableId: string;
   filters?: Record<string, unknown>;
   renderExpanded?: (row: any) => React.ReactNode;
+  // New px-based widths (preferred)
+  columnWidthsPx?: Record<string, number>;
+  // Legacy percentage widths (for backward compatibility during migration)
   columnWidthsPct?: Record<string, number>;
   tableContainerRef?: React.MutableRefObject<HTMLElement | null>;
   onMouseDownResize?: (e: React.MouseEvent<HTMLDivElement>, columnId: string) => void;
   filtersConfig?: {
     columns: FilterColumn[];
+    // New px-based widths for filter row
+    columnWidthsPx?: Record<string, number>;
+    // Legacy percentage widths
     columnWidthsPct?: Record<string, number>;
     show?: boolean;
     search?: string;
@@ -98,7 +104,8 @@ function TanStackDataTable<T = Record<string, unknown>>({
   table,
   dataIds,
   renderExpanded,
-  columnWidthsPct,
+  columnWidthsPx,
+  columnWidthsPct, // Legacy support
   tableContainerRef,
   onMouseDownResize,
   filtersConfig,
@@ -107,7 +114,7 @@ function TanStackDataTable<T = Record<string, unknown>>({
     <SortableContext items={dataIds}>
       <div ref={tableContainerRef as any} className="overflow-x-auto" data-testid="data-table">
         {/* table-fixed makes width styles on th/td actually apply; min-w-max allows horizontal growth */}
-        <Table className="min-w-max table-fixed">
+        <Table className="min-w-max" style={{ tableLayout: "fixed" }}>
           <TableHeader>
             {table.getHeaderGroups().map((headerGroup) => (
               <TableRow key={headerGroup.id}>
@@ -116,14 +123,20 @@ function TanStackDataTable<T = Record<string, unknown>>({
                     key={header.id}
                     className="p-3 border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 relative"
                     style={
-                      columnWidthsPct?.[header.column.id] != null
+                      columnWidthsPx?.[header.column.id] != null
                         ? {
-                            width: `${columnWidthsPct[header.column.id]}%`,
-                            maxWidth: `${columnWidthsPct[header.column.id]}%`,
-                            // NEW: never let headers collapse below a readable width
-                            minWidth: (header.column.columnDef as any)?.meta?.minPx ?? 128,
+                            width: `${columnWidthsPx[header.column.id]}px`,
+                            minWidth: (header.column.columnDef as any)?.meta?.minPx ?? 80,
+                            maxWidth: (header.column.columnDef as any)?.meta?.maxPx,
                           }
-                        : { minWidth: (header.column.columnDef as any)?.meta?.minPx ?? 128 }
+                        : columnWidthsPct?.[header.column.id] != null
+                          ? {
+                              // Legacy percentage support
+                              width: `${columnWidthsPct[header.column.id]}%`,
+                              maxWidth: `${columnWidthsPct[header.column.id]}%`,
+                              minWidth: (header.column.columnDef as any)?.meta?.minPx ?? 128,
+                            }
+                          : { minWidth: (header.column.columnDef as any)?.meta?.minPx ?? 128 }
                     }
                   >
                     {header.isPlaceholder ? null : flexRender(header.column.columnDef.header, header.getContext())}
@@ -163,14 +176,20 @@ function TanStackDataTable<T = Record<string, unknown>>({
    key={cell.id}
    className="p-3"
    style={
-     columnWidthsPct?.[cell.column.id] != null
+     columnWidthsPx?.[cell.column.id] != null
        ? {
-           width: `${columnWidthsPct[cell.column.id]}%`,
-           maxWidth: `${columnWidthsPct[cell.column.id]}%`,
-           // NEW: keep body cells in sync with header min
-           minWidth: (cell.column.columnDef as any)?.meta?.minPx ?? 128,
+           width: `${columnWidthsPx[cell.column.id]}px`,
+           minWidth: (cell.column.columnDef as any)?.meta?.minPx ?? 80,
+           maxWidth: (cell.column.columnDef as any)?.meta?.maxPx,
          }
-       : { minWidth: (cell.column.columnDef as any)?.meta?.minPx ?? 128 }
+       : columnWidthsPct?.[cell.column.id] != null
+         ? {
+             // Legacy percentage support
+             width: `${columnWidthsPct[cell.column.id]}%`,
+             maxWidth: `${columnWidthsPct[cell.column.id]}%`,
+             minWidth: (cell.column.columnDef as any)?.meta?.minPx ?? 128,
+           }
+         : { minWidth: (cell.column.columnDef as any)?.meta?.minPx ?? 128 }
    }
  >
                         {/* Pure truncation; no tooltip */}
diff --git a/src/components/data-table/use-column-resize.ts b/src/components/data-table/use-column-resize.ts
index 11faf39..8f430b4 100644
--- a/src/components/data-table/use-column-resize.ts
+++ b/src/components/data-table/use-column-resize.ts
@@ -1,16 +1,19 @@
 // src/components/data-table/useColumnResize.ts
 import { MutableRefObject, useCallback, useRef, useState } from "react";
 
-type Widths = Record<string, number>; // percentages
+type Widths = Record<string, number>; // pixel widths
 
 type Options = {
-  /** clamp percentages (inclusive) */
-  minPct?: number;
-  maxPct?: number;
+  /** minimum pixel width (inclusive) */
+  minPx?: number;
+  /** maximum pixel width (inclusive) */
+  maxPx?: number;
+  /** column definitions to extract minPx/maxPx from meta */
+  getColumnMeta?: (columnId: string) => { minPx?: number; maxPx?: number } | null;
 };
 
 export function useColumnResize(initial: Widths, tableRef: MutableRefObject<HTMLElement | null>, opts: Options = {}) {
-  const { minPct = 5, maxPct = 80 } = opts;
+  const { minPx: defaultMinPx = 80, maxPx: defaultMaxPx = 800, getColumnMeta } = opts;
 
   const [widths, setWidths] = useState<Widths>(initial);
   const [isResizing, setIsResizing] = useState(false);
@@ -26,9 +29,12 @@ export function useColumnResize(initial: Widths, tableRef: MutableRefObject<HTML
       e.preventDefault();
       e.stopPropagation();
 
-      const tableWidth = tableRef.current?.getBoundingClientRect().width ?? window.innerWidth;
+      // Get current column width in pixels from DOM or state
+      const headerEl = e.currentTarget.closest('th');
+      const currentWidthPx = headerEl?.getBoundingClientRect().width ?? (widths[columnId] ?? defaultMinPx);
+      
       startXRef.current = e.clientX;
-      startWidthRef.current = widths && columnId in widths ? widths[columnId] : 10;
+      startWidthRef.current = currentWidthPx;
 
       setIsResizing(true);
       setResizingColumnId(columnId);
@@ -37,12 +43,17 @@ export function useColumnResize(initial: Widths, tableRef: MutableRefObject<HTML
         if (!columnId) return;
 
         const deltaX = ev.clientX - startXRef.current;
-        const deltaPct = (deltaX / tableWidth) * 100;
-        const next = Math.max(minPct, Math.min(maxPct, startWidthRef.current + deltaPct));
+        const newWidthPx = startWidthRef.current + deltaX;
+
+        // Get column-specific min/max from meta or use defaults
+        const meta = getColumnMeta?.(columnId);
+        const minPx = meta?.minPx ?? defaultMinPx;
+        const maxPx = meta?.maxPx ?? defaultMaxPx;
+        const clampedWidth = Math.max(minPx, Math.min(maxPx, newWidthPx));
 
         setWidths((prev) => {
-          if (!prev) return { [columnId]: next };
-          return { ...prev, [columnId]: next };
+          if (!prev) return { [columnId]: clampedWidth };
+          return { ...prev, [columnId]: clampedWidth };
         });
 
         document.body.style.cursor = "col-resize";
@@ -61,7 +72,7 @@ export function useColumnResize(initial: Widths, tableRef: MutableRefObject<HTML
       document.addEventListener("mousemove", onMove);
       document.addEventListener("mouseup", onUp);
     },
-    [tableRef, widths, minPct, maxPct],
+    [tableRef, widths, defaultMinPx, defaultMaxPx, getColumnMeta],
   );
 
   return {
diff --git a/src/components/data-table/use-saved-views.ts b/src/components/data-table/use-saved-views.ts
index 8d9eae3..51c7d2f 100644
--- a/src/components/data-table/use-saved-views.ts
+++ b/src/components/data-table/use-saved-views.ts
@@ -18,6 +18,11 @@ export type SavedView = {
   visibleColumns: Record<string, boolean>;
   sortConfig: SortConfig;
   createdAt: string; // ISO
+  // New px-based column widths (preferred)
+  columnWidthsPx?: Record<string, number>;
+  baselineWidthPx?: number;
+  // Legacy percentage widths (deprecated, kept for migration)
+  columnWidthsPct?: Record<string, number>;
 };
 
 export type ViewSnapshot = Omit<SavedView, "id" | "createdAt">;
diff --git a/src/components/forms/resource-view/resource-table-client.tsx b/src/components/forms/resource-view/resource-table-client.tsx
index 5648bdf..8c298df 100644
--- a/src/components/forms/resource-view/resource-table-client.tsx
+++ b/src/components/forms/resource-view/resource-table-client.tsx
@@ -59,6 +59,7 @@ import { StatusCellWrapper } from "@/components/data-table/status-cell-wrapper";
 import { stringPredicate } from "@/components/data-table/table-utils";
 import { useColumnResize } from "@/components/data-table/use-column-resize";
 import { useSavedViews } from "@/components/data-table/use-saved-views";
+import { useContainerResize } from "@/components/data-table/use-container-resize";
 import type { BaseViewConfig } from "@/components/data-table/view-defaults";
 import { useOptimistic } from "@/components/forms/shell/optimistic-context";
 import { fetchResourcePageClient } from "@/lib/api/client-fetch";
@@ -250,6 +251,34 @@ export default function ResourceTableClient<TRow extends { id: string }>({
     return [];
   }, [config]);
 
+  // -- Saved Views: tableId and defaultColumnIds MUST be declared early to avoid TDZ -----------
+  // These are used by useSavedViews hook and effects, so they must come before any effects that reference them
+  const tableId = React.useMemo(() => {
+    const routeSegment = (config as any)?.formsRouteSegment ?? "table";
+    return `forms/${routeSegment}`;
+  }, [config]);
+
+  const defaultColumnIds = React.useMemo(() => {
+    const all = baseColumns.map((c) => String((c as any).id ?? (c as any).accessorKey ?? ""));
+    // keep __select first if present
+    const selectId = all.find((id) => id === "__select");
+    const others = all.filter((id) => id && id !== "__select");
+    return selectId ? [selectId, ...others] : others;
+  }, [baseColumns]);
+
+  // Saved Views: hydrate & persist state - declared early to avoid TDZ
+  const {
+    views,
+    currentView,
+    currentViewId,
+    setCurrentViewId,
+    applyView,
+    saveView,
+    updateView,
+    setDefault,
+    hydrateFromRemote,
+  } = useSavedViews(tableId, defaultColumnIds);
+
   // Local TanStack table state
   const [sorting, setSorting] = React.useState<Array<{ id: string; desc: boolean }>>([]);
   const [rowSelection, setRowSelection] = React.useState({});
@@ -287,39 +316,58 @@ export default function ResourceTableClient<TRow extends { id: string }>({
   // ðŸ”— Table element ref (needed by the resize hook and passed to DataTable)
   const tableRef = React.useRef<HTMLElement | null>(null);
 
-  // âœ… Initialize column widths from config column `size` values (convert pixels to percentages)
-  // This prevents auto-calculation from changing widths when data refreshes (e.g., after inline edit)
+  // Utility: Create stable signature from column definitions to detect schema changes
+  // Minimal signature: only { id, size, minSize, maxSize } to avoid unnecessary recalculations
+  const columnsSignature = React.useCallback((cols: ColumnDef<TRow, unknown>[]): string => {
+    return JSON.stringify(
+      cols.map((c) => ({
+        id: c.id ?? (c as any).accessorKey,
+        size: (c as any).size,
+        minSize: (c as any).minSize ?? (c.meta as any)?.minPx,
+        maxSize: (c as any).maxSize ?? (c.meta as any)?.maxPx,
+      }))
+    );
+  }, []);
+
+  // Memoize column signature to detect real schema changes
+  const colsSig = React.useMemo(() => columnsSignature(baseColumns), [baseColumns, columnsSignature]);
+
+  // âœ… Initialize column widths (priority: saved px â†’ config px â†’ auto-calc)
+  // Store as pixels, not percentages
   const initialColumnWidths = React.useMemo<Record<string, number>>(() => {
     const widths: Record<string, number> = {};
-    let totalPixels = 0;
-    
-    // First pass: sum all pixel sizes to normalize
+
+    // First priority: Use config `size` values directly as pixels
     for (const col of baseColumns) {
       if (col.id && (col as any).size && typeof (col as any).size === "number") {
         const size = (col as any).size as number;
         if (size > 0) {
-          totalPixels += size;
-        }
-      }
-    }
-    
-    // Second pass: convert to percentages
-    if (totalPixels > 0) {
-      for (const col of baseColumns) {
-        if (col.id && (col as any).size && typeof (col as any).size === "number") {
-          const size = (col as any).size as number;
-          if (size > 0) {
-            widths[col.id] = (size / totalPixels) * 100;
-          }
+          widths[col.id] = size;
         }
       }
     }
-    
+
     return widths;
-  }, [baseColumns]);
+  }, [colsSig]); // Only recalculate when column schema changes
+
+  // Track container width for responsive scaling
+  const containerWidthPx = useContainerResize(tableRef, true);
 
   // Column widths state for resizing (initialize from config sizes, then user can override)
-  const { widths: columnWidths, setWidths, isResizing, onMouseDownResize } = useColumnResize(initialColumnWidths, tableRef);
+  const { widths: columnWidths, setWidths, isResizing, onMouseDownResize } = useColumnResize(
+    initialColumnWidths,
+    tableRef,
+    {
+      getColumnMeta: (columnId: string) => {
+        const col = baseColumns.find((c) => c.id === columnId);
+        if (!col) return null;
+        return {
+          minPx: (col.meta as any)?.minPx ?? (col as any).minSize,
+          maxPx: (col.meta as any)?.maxPx ?? (col as any).maxSize,
+        };
+      },
+    }
+  );
 
   // Track currently dragged column id to render an overlay ghost
   const [activeColumnId, setActiveColumnId] = React.useState<string | null>(null);
@@ -631,7 +679,7 @@ export default function ResourceTableClient<TRow extends { id: string }>({
     getExpandedRowModel: getExpandedRowModel(),
     getPaginationRowModel: getPaginationRowModel(),
     getFilteredRowModel: getFilteredRowModel(),
-    columnResizeMode: "onChange",
+    columnResizeMode: "onEnd", // Only update on resize end, not during drag
     enableRowSelection: true,
     enableColumnResizing: enableColumnResizing,
     // âœ… use the same idField consistently for stable keys
@@ -641,6 +689,73 @@ export default function ResourceTableClient<TRow extends { id: string }>({
     },
   });
 
+  // Hydrate from remote on mount (fire-and-forget, keep local fallback if unauth)
+  React.useEffect(() => {
+    // TODO: Implement remote hydration if needed
+    // hydrateFromRemote(remoteViews);
+  }, [tableId, hydrateFromRemote, defaultColumnIds]);
+
+  // Apply current view to column widths on mount (if saved px widths exist)
+  // Also migrate legacy columnWidthsPct to px if needed
+  // Guarded: only runs when currentView and setWidths are available
+  React.useEffect(() => {
+    if (!currentView || !setWidths) return;
+
+    // Priority 1: Use saved px widths if available
+    if (currentView.columnWidthsPx && Object.keys(currentView.columnWidthsPx).length > 0) {
+      setWidths(currentView.columnWidthsPx);
+      return;
+    }
+
+    // Priority 2: Migrate legacy columnWidthsPct to px (one-time conversion)
+    const legacyPct = (currentView as any).columnWidthsPct;
+    if (legacyPct && Object.keys(legacyPct).length > 0 && containerWidthPx && containerWidthPx > 0) {
+      // Convert percentage widths to pixels using current container width
+      const migratedPx: Record<string, number> = {};
+      for (const [columnId, pctWidth] of Object.entries(legacyPct)) {
+        const col = baseColumns.find((c) => c.id === columnId);
+        const minPx = (col?.meta as any)?.minPx ?? (col as any).minSize ?? 80;
+        const maxPx = (col?.meta as any)?.maxPx ?? (col as any).maxSize;
+        const pxWidth = Math.round((pctWidth as number / 100) * containerWidthPx);
+        migratedPx[columnId] = maxPx
+          ? Math.min(maxPx, Math.max(minPx, pxWidth))
+          : Math.max(minPx, pxWidth);
+      }
+      if (Object.keys(migratedPx).length > 0) {
+        setWidths(migratedPx);
+        // Persist migrated widths with baseline
+        if (currentViewId && updateView) {
+          updateView(currentViewId, {
+            columnWidthsPx: migratedPx,
+            baselineWidthPx: containerWidthPx,
+          });
+        }
+      }
+    }
+  }, [currentView, setWidths, containerWidthPx, baseColumns, currentViewId, updateView]);
+
+  // Calculate responsive scaling for render widths
+  const renderColumnWidthsPx = React.useMemo(() => {
+    const widths: Record<string, number> = {};
+    const baselineWidth = currentView?.baselineWidthPx ?? containerWidthPx ?? null;
+
+    // If we have baseline and container widths, apply responsive scaling
+    if (baselineWidth && containerWidthPx && Object.keys(columnWidths).length > 0) {
+      const scale = Math.max(0.7, Math.min(1.4, containerWidthPx / baselineWidth));
+      for (const [columnId, savedWidthPx] of Object.entries(columnWidths)) {
+        const col = baseColumns.find((c) => c.id === columnId);
+        const minPx = (col?.meta as any)?.minPx ?? (col as any).minSize ?? 80;
+        const maxPx = (col?.meta as any)?.maxPx ?? (col as any).maxSize;
+        const scaledWidth = Math.round(savedWidthPx * scale);
+        widths[columnId] = maxPx ? Math.min(maxPx, Math.max(minPx, scaledWidth)) : Math.max(minPx, scaledWidth);
+      }
+      return widths;
+    }
+
+    // Otherwise use saved widths directly (or initial widths)
+    return columnWidths;
+  }, [columnWidths, currentView?.baselineWidthPx, containerWidthPx, baseColumns]);
+
   // âœ… Seed initial column order once the table is ready
   React.useEffect(() => {
     // Collect leaf column ids as strings, put __select first, then other columns, actions last
@@ -772,50 +887,28 @@ export default function ResourceTableClient<TRow extends { id: string }>({
   // âœ… FIX 3: Move dragIdRef outside the useMemo to avoid hook-in-callback issue
   const dragIdRef = React.useRef<string | null>(null);
 
-  // -- Saved Views: hydrate & persist state ---------------------------------
-  const tableId = React.useMemo(() => {
-    const routeSegment = (config as any)?.formsRouteSegment ?? "table";
-    return `forms/${routeSegment}`;
-  }, [config]);
-
-  const defaultColumnIds = React.useMemo(() => {
-    const all = baseColumns.map((c) => String((c as any).id ?? (c as any).accessorKey ?? ""));
-    // keep __select first if present
-    const selectId = all.find((id) => id === "__select");
-    const others = all.filter((id) => id && id !== "__select");
-    return selectId ? [selectId, ...others] : others;
-  }, [baseColumns]);
-
-  // Temporarily disable saved views to prevent flickering
-  const views: any[] = [];
-  const currentView = null;
-  const setCurrentViewId = () => {};
-  const applyView = () => {};
-  saveView = () => {};
-  const updateView = () => {};
-  const setDefault = () => {};
-  const hydrateFromRemote = () => {};
-
-  // Hydrate from remote on mount (fire-and-forget, keep local fallback if unauth)
-  // Disabled temporarily to prevent flickering
+  // Persist width changes when columnWidths change (triggered by custom resize hook)
+  // This bridges our custom resize hook with saved views persistence
+  // Guarded against TDZ: effect only runs when prerequisites exist
   React.useEffect(() => {
-    // Saved views functionality temporarily disabled
-    return;
-  }, [tableId, hydrateFromRemote, defaultColumnIds]);
-
-  // Apply current view to column order/visibility/widths once when table is ready
-  // Disabled temporarily to prevent flickering
-  React.useEffect(() => {
-    // Saved views functionality temporarily disabled
-    return;
-  }, [currentView, defaultColumnIds, setWidths]);
-
-  // Persist state changes into current view snapshot
-  // Disabled temporarily to prevent flickering
-  React.useEffect(() => {
-    // Saved views functionality temporarily disabled
-    return;
-  }, [columnOrder, columnVisibility, columnWidths, table, updateView, currentView]);
+    // Early return if prerequisites missing (guard against TDZ)
+    if (!currentViewId || !updateView || containerWidthPx === null || containerWidthPx === undefined) {
+      return;
+    }
+    if (Object.keys(columnWidths).length === 0) {
+      return;
+    }
+    // Debounce persistence to avoid excessive updates (only on resize end, not during drag)
+    const timeoutId = setTimeout(() => {
+      // Ensure baselineWidthPx is initialized if not set (first persistence)
+      const baseline = currentView?.baselineWidthPx ?? containerWidthPx;
+      updateView(currentViewId, {
+        columnWidthsPx: columnWidths,
+        baselineWidthPx: baseline,
+      });
+    }, 500); // Wait 500ms after last resize before persisting
+    return () => clearTimeout(timeoutId);
+  }, [columnWidths, currentViewId, containerWidthPx, updateView, currentView?.baselineWidthPx]);
 
   // âœ… Auto-assign smart percentage widths from data (on-demand only)
   // NOTE: Only recalculate when columns change, NOT when data changes (uses initialRows, not filteredRows)
@@ -850,7 +943,8 @@ export default function ResourceTableClient<TRow extends { id: string }>({
         const state = {
           columnOrder,
           columnVisibility,
-          columnWidthsPct: columnWidths,
+          columnWidthsPx: columnWidths, // Use px instead of pct
+          baselineWidthPx: containerWidthPx ?? undefined,
           sortConfig:
             table.getState().sorting?.[0]
               ? {
@@ -894,7 +988,8 @@ export default function ResourceTableClient<TRow extends { id: string }>({
         const state = {
           columnOrder,
           columnVisibility,
-          columnWidthsPct: columnWidths,
+          columnWidthsPx: columnWidths, // Use px instead of pct
+          baselineWidthPx: containerWidthPx ?? undefined,
           sortConfig:
             table.getHeaders().sorting?.[0]
               ? {
@@ -1093,10 +1188,11 @@ export default function ResourceTableClient<TRow extends { id: string }>({
                 }))}
                 currentViewId="default"
                 onApplyView={(v) => {
-                  // applyView(v.id); // Disabled temporarily
+                  applyView(v.id);
                   setColumnOrder(v.columnOrder);
                   setColumnVisibility(v.visibleColumns as any);
-                  const w = (v as any).columnWidthsPct;
+                  // Prefer px widths, fallback to legacy pct
+                  const w = (v as any).columnWidthsPx ?? (v as any).columnWidthsPct;
                   if (w) setWidths(w);
                 }}
                 onDeleteView={(id) => {
@@ -1138,6 +1234,17 @@ export default function ResourceTableClient<TRow extends { id: string }>({
                     setColumnOrder(initialOrderRef.current);
                   }
                 }}
+                onResetWidths={() => {
+                  // Clear saved widths and re-apply config defaults
+                  setWidths(initialColumnWidths);
+                  if (currentViewId && updateView && containerWidthPx) {
+                    // Reset to config defaults and set fresh baseline for future scaling
+                    updateView(currentViewId, {
+                      columnWidthsPx: undefined,
+                      baselineWidthPx: containerWidthPx, // Set fresh baseline for reset state
+                    });
+                  }
+                }}
                 onDragStart={onDragStart}
                 onDragOver={onDragOver}
                 onDrop={onDrop}
@@ -1220,7 +1327,7 @@ export default function ResourceTableClient<TRow extends { id: string }>({
         </div>
       </div>
     );
-  }, [showMoreFilters, filters]);
+  }, [showMoreFilters, filters, onClearFilters]);
 
   // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø¹Ù…Ø¯Ø© ØµÙ Ø§Ù„ÙÙ„Ø§ØªØ± Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø¨Ù…Ø§ ÙÙŠÙ‡Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø®Ø§ØµØ© ÙØ§Ø±ØºØ©)
   const filterColumns: FilterColumn[] = React.useMemo(() => {
@@ -1387,20 +1494,24 @@ export default function ResourceTableClient<TRow extends { id: string }>({
           sensors={sensors}
           sortableId="resource-table"
           renderExpanded={renderExpanded ? (row) => renderExpanded(row.original as TRow) : undefined}
-          // âœ… Use config-based initial widths (converted from pixels to %), or user-resized widths
-          // Only fall back to auto-calculated if neither is available
+          // âœ… Use responsive pixel widths (with scaling if baseline exists)
+          columnWidthsPx={renderColumnWidthsPx}
+          // Legacy percentage support for backward compatibility
           columnWidthsPct={
-            Object.keys(columnWidths).length > 0 
-              ? columnWidths 
-              : (Object.keys(autoColumnWidthsPct).length > 0 ? autoColumnWidthsPct : {})
+            Object.keys(renderColumnWidthsPx).length === 0 && Object.keys(autoColumnWidthsPct).length > 0
+              ? autoColumnWidthsPct
+              : undefined
           }
           tableContainerRef={tableRef}
           filtersConfig={{
             columns: filterColumns,
-            // Use config-based initial widths (converted from pixels to %), or user-resized widths
-            columnWidthsPct: Object.keys(columnWidths).length > 0 
-              ? columnWidths 
-              : (Object.keys(autoColumnWidthsPct).length > 0 ? autoColumnWidthsPct : {}),
+            // Use responsive pixel widths for filter row
+            columnWidthsPx: renderColumnWidthsPx,
+            // Legacy percentage support
+            columnWidthsPct:
+              Object.keys(renderColumnWidthsPx).length === 0 && Object.keys(autoColumnWidthsPct).length > 0
+                ? autoColumnWidthsPx
+                : undefined,
 
             show: showMoreFilters,
             filters,
warning: in the working copy of 'src/components/data-table/use-column-resize.ts', LF will be replaced by CRLF the next time Git touches it

===== STAGED DIFF =====
(none)

===== DELETED/RENAMED FILES SUMMARY =====
warning: in the working copy of 'src/components/data-table/columns-menu.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/data-table/use-column-resize.ts', LF will be replaced by CRLF the next time Git touches it

===== UNTRACKED FILES =====
AUDIT_COLUMN_RESIZE.md
docs/diagnostics/
src/components/data-table/use-container-resize.ts

===== UNTRACKED FILE: AUDIT_COLUMN_RESIZE.md =====
diff --git a/AUDIT_COLUMN_RESIZE.md b/AUDIT_COLUMN_RESIZE.md
new file mode 100644
index 0000000..e69de29
--- /dev/null
+++ b/AUDIT_COLUMN_RESIZE.md
@@ -0,0 +1,161 @@
+# Column Resize System Audit
+
+## Current Flow
+
+```
+Config (px sizes) 
+  â†“
+initialColumnWidths (resource-table-client.tsx:292-319)
+  - Converts px â†’ %
+  - Recalculates whenever baseColumns changes (unstable reference)
+  â†“
+useColumnResize hook (stores % widths)
+  - Uses percentage-based calculations
+  - Updates on every mouse move during resize
+  â†“
+DOM rendering (data-table.tsx)
+  - Applies widths as percentages: width: X%
+  - No responsive scaling
+  â†“
+useSavedViews (persistence)
+  - Stores columnWidthsPct (percentages)
+  - No baseline container width
+```
+
+## Anti-Patterns Found
+
+### 1. Percentage-Based Storage
+- **Location:** `use-column-resize.ts`, `use-saved-views.ts`
+- **Issue:** Widths stored as percentages, which change with container size
+- **Impact:** Unstable widths on window resize, no responsive scaling
+
+### 2. Unstable initialColumnWidths Recalculation
+- **Location:** `resource-table-client.tsx:292-319`
+- **Issue:** Recalculates whenever `baseColumns` changes, which happens on every render due to unstable reference
+- **Root Cause:** `baseColumns` is derived from `config.columns` or `config.buildColumns()`, both create new array references
+- **Impact:** Performance degradation, unnecessary recalculations
+
+### 3. No Baseline Container Width Tracking
+- **Location:** Missing entirely
+- **Issue:** Cannot implement responsive scaling without knowing the baseline container width
+- **Impact:** No responsive behavior, widths break on different screen sizes
+
+### 4. columnResizeMode: "onChange"
+- **Location:** `resource-table-client.tsx:634`
+- **Issue:** Updates on every mouse move during resize
+- **Impact:** Excessive state updates, potential performance issues
+
+### 5. Unstable viewConfig Reference
+- **Location:** `stock-adjustments-table-client.tsx:29-36`
+- **Issue:** Creates new `viewConfigWithColumns` object on every render
+- **Impact:** Triggers downstream recalculations in ResourceTableClient
+
+### 6. Data-Dependent Auto-Width Calculation (Partially Fixed)
+- **Location:** `resource-table-client.tsx:823-838`
+- **Status:** Already fixed to use `initialRows` instead of `filteredRows`
+- **Note:** Still uses percentage-based calculations
+
+## Performance Risks
+
+### High Priority
+1. **initialColumnWidths recalculates on every render**
+   - Triggered by unstable `baseColumns` reference
+   - Affects: All ResourceTableClient instances
+   - Impact: Unnecessary CPU usage, potential UI jank
+
+2. **No memoization of viewConfig**
+   - Creates new object reference on each render
+   - Triggers React re-renders downstream
+   - Impact: Cascading performance degradation
+
+3. **ResizeObserver missing**
+   - Cannot implement efficient responsive scaling
+   - Impact: Poor UX on different screen sizes
+
+### Medium Priority
+1. **Percentage-based width calculations**
+   - Requires container width lookups on every render
+   - Impact: Minor performance overhead
+
+2. **No throttling/debouncing on resize**
+   - Updates on every mouse move
+   - Impact: Excessive state updates during resize
+
+## File Responsibilities
+
+### `use-column-resize.ts`
+- **Current:** Handles mouse resize events, stores percentage widths
+- **Issues:** Uses percentages, updates on every mouse move
+- **Dependencies:** `tableRef` for container width calculation
+
+### `resource-table-client.tsx`
+- **Current:** 
+  - Converts config px â†’ % in `initialColumnWidths`
+  - Integrates `useColumnResize` hook
+  - Manages column state
+- **Issues:** 
+  - Unstable `baseColumns` reference causes recalculation
+  - Percentage conversion logic
+  - No ResizeObserver for responsive scaling
+
+### `use-saved-views.ts`
+- **Current:** Stores `columnWidthsPct` (percentages)
+- **Issues:** Legacy % format, no baseline width
+- **Dependencies:** localStorage for persistence
+
+### `data-table.tsx`
+- **Current:** Renders widths as percentages in inline styles
+- **Issues:** No `tableLayout: 'fixed'`, percentage-based widths
+- **Dependencies:** Receives `columnWidthsPct` prop
+
+### `stock-adjustments-table-client.tsx`
+- **Current:** Creates `viewConfigWithColumns` by calling `buildColumns()`
+- **Issues:** New object reference on every render
+- **Dependencies:** `stockAdjustmentsViewConfig.buildColumns()`
+
+## Proposed Fix Summary
+
+### Core Changes
+1. **Convert to pixel-based storage**
+   - Store `columnWidthsPx` and `baselineWidthPx` instead of percentages
+   - Calculate responsive scaling using: `renderWidth = savedWidth * (containerWidth / baselineWidth)`
+
+2. **Stable initialization**
+   - Use column signature to detect actual schema changes
+   - Memoize `initialColumnWidths` with stable dependencies
+   - Priority: Saved px â†’ Config px â†’ Auto-calc
+
+3. **ResizeObserver integration**
+   - Track container width with throttling
+   - Store baseline when user manually resizes
+   - Apply responsive scaling on window resize
+
+4. **Performance optimizations**
+   - Memoize `viewConfig` and `columns` arrays
+   - Use `columnResizeMode: "onEnd"` instead of `"onChange"`
+   - Debounce ResizeObserver updates
+
+### Migration Strategy
+- Keep backward compatibility with legacy `columnWidthsPct` during transition
+- Version saved view format (v2) to invalidate old caches
+- Provide "Reset widths" action to clear legacy data
+
+## Success Criteria
+
+### Functional
+- âœ… Widths persist across reloads
+- âœ… Widths stable during inline edits
+- âœ… Responsive scaling on window resize
+- âœ… Manual resize persists correctly
+
+### Performance
+- âœ… `initialColumnWidths` only recalculates on schema changes
+- âœ… Stable references for `viewConfig` and `columns`
+- âœ… Throttled ResizeObserver updates
+- âœ… No reflows on data changes
+
+### Code Quality
+- âœ… No percentage widths in new code
+- âœ… Generic, config-driven implementation
+- âœ… Uses TanStack native `columnSizing` model
+

===== UNTRACKED FILE: docs/diagnostics/STOCK_ADJUSTMENTS_LOAD_REPORT.md =====
diff --git a/docs/diagnostics/STOCK_ADJUSTMENTS_LOAD_REPORT.md b/docs/diagnostics/STOCK_ADJUSTMENTS_LOAD_REPORT.md
new file mode 100644
index 0000000..f8a9b0c
--- /dev/null
+++ b/docs/diagnostics/STOCK_ADJUSTMENTS_LOAD_REPORT.md
@@ -0,0 +1,847 @@
+# Stock Adjustments Load Profile Report
+
+**Date**: 2025-01-29  
+**Route**: `/forms/stock-adjustments`  
+**Scope**: Complete SSR â†’ Client Hydration â†’ First Paint Analysis  
+**Objective**: Identify load bottlenecks and optimization opportunities
+
+---
+
+## Executive Summary
+
+This report maps the complete import chain and execution timeline for the Stock Adjustments screen from server-side rendering through client hydration. The analysis identifies:
+
+- **SSR Path**: Page component â†’ API fetch â†’ data transformation â†’ HTML generation
+- **Client Hydration**: React hydration â†’ table initialization â†’ React Query setup
+- **Interaction-Only Code**: Deferrable components (column resize, saved views, inline editors)
+
+**Key Findings**:
+- Multiple large libraries loaded on initial paint (TanStack Table, DnD Kit, React Query)
+- Column generation runs on every render (unstable memoization)
+- Several interaction-only features loaded eagerly
+- Bundle size analysis needed to quantify impact
+
+---
+
+## 1. Import Chain Mapping
+
+### 1.1 SSR Path (Server Component)
+
+**Entry Point**: `src/app/(main)/forms/stock-adjustments/page.tsx`
+
+#### Direct Imports (SSR-only)
+```typescript
+// Next.js metadata (SSR-only)
+import type { Metadata } from "next";
+
+// Server components
+import PageShell from "@/components/forms/shell/page-shell";
+import { fetchResourcePage } from "@/lib/data/resource-fetch";
+import { resolveSearchParams, parseListParams, type SPRecord } from "@/lib/next/search-params";
+
+// Local config (server-safe)
+import { config, stockAdjustmentsFilterMeta, statusToQuery } from "./stock-adjustments.config";
+import { toRow } from "./to-row";
+import { StockAdjustmentsTableClient } from "./stock-adjustments-table-client";
+```
+
+#### Transitive Imports (SSR execution)
+
+**PageShell â†’** `src/components/forms/shell/page-shell.tsx`
+- Server Component (no client hooks)
+- Imports: React (SSR-safe), lucide-react icons (SSR-safe), UI components (Badge, Button)
+- Wraps children with OptimisticProvider (context provider, SSR-safe)
+
+**fetchResourcePage â†’** `src/lib/data/resource-fetch.ts`
+- Server-only function
+- Imports: `getServerBaseUrl`, `getForwardedCookieHeader` from `@/lib/ssr/http`
+- Uses native `fetch` with Next.js cache options
+
+**stock-adjustments.config.tsx**
+- Mixed: some client-only functions (`buildColumns`, `makeActionsColumn`)
+- Exports: `config`, `stockAdjustmentsFilterMeta`, `statusToQuery` (server-safe)
+- Note: Config file contains JSX but functions are not executed during SSR import
+
+**to-row.ts**
+- Server-safe transformation function
+- Pure data mapping (no client dependencies)
+
+**StockAdjustmentsTableClient â†’** `src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx`
+- **CLIENT COMPONENT** ("use client")
+- Marked as client boundary; code not executed during SSR, only serialized for hydration
+
+#### SSR Execution Timeline
+
+```
+1. page.tsx (async component)
+   â”œâ”€ resolveSearchParams()        ~1-2ms
+   â”œâ”€ parseListParams()             ~1-2ms
+   â”œâ”€ statusToQuery() transform     ~0.1ms
+   â”œâ”€ fetchResourcePage()
+   â”‚   â”œâ”€ getServerBaseUrl()       ~1ms
+   â”‚   â”œâ”€ getForwardedCookieHeader() ~1ms
+   â”‚   â”œâ”€ HTTP fetch to /api/...    ~50-200ms (database query)
+   â”‚   â””â”€ JSON parse                ~2-5ms
+   â”œâ”€ toRow() mapping (per row)    ~1-5ms (depends on row count)
+   â””â”€ JSX render
+       â”œâ”€ PageShell                 ~5-10ms
+       â””â”€ StockAdjustmentsTableClient (serialized only) ~0ms (client boundary)
+```
+
+**Estimated SSR Time**: 60-230ms (excluding database query which varies by data size)
+
+**API Route Chain**: `GET /api/v_tcm_user_tally_card_entries`
+- Handler: `src/app/api/[resource]/route.ts`
+- Implementation: `src/lib/api/handle-list.ts`
+- Database: Supabase query with pagination/filtering
+
+---
+
+### 1.2 Client Hydration Path
+
+**Entry Point**: `src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx`
+
+#### Client Component Imports
+
+```typescript
+// React core (client)
+import { useMemo } from "react";
+
+// Generic table client (heavy)
+import ResourceTableClient from "@/components/forms/resource-view/resource-table-client";
+
+// Types only
+import type { BaseViewConfig } from "@/components/data-table/view-defaults";
+import type { StockAdjustmentRow } from "./stock-adjustments.config";
+import { stockAdjustmentsViewConfig } from "./stock-adjustments.config";
+```
+
+#### ResourceTableClient Imports (Heavy Component)
+
+**React & Routing**:
+- `react`, `react-dom` (core)
+- `next/navigation` (useRouter, useSearchParams, usePathname)
+
+**Data Fetching & State**:
+- `@tanstack/react-query` (useQuery, useQueryClient) - **~50KB gzipped**
+- `zustand` (via selection-store) - **~3KB gzipped**
+
+**Table Library**:
+- `@tanstack/react-table` - **~80KB gzipped**
+  - getCoreRowModel, getSortedRowModel, getExpandedRowModel
+  - getPaginationRowModel, getFilteredRowModel, useReactTable
+  - ColumnDef, ColumnOrderState, VisibilityState, Row types
+
+**Drag & Drop**:
+- `@dnd-kit/core` - **~25KB gzipped**
+  - DndContext, DragStartEvent, KeyboardSensor, PointerSensor
+  - useSensor, useSensors, DragEndEvent, UniqueIdentifier, DragOverlay
+- `@dnd-kit/sortable` - **~15KB gzipped**
+  - arrayMove, SortableContext, horizontalListSortingStrategy
+
+**Icons**:
+- `lucide-react` (7 icons) - **~5KB per icon tree-shaken**
+
+**UI Components** (Radix UI + shadcn):
+- `@/components/ui/button`
+- `@/components/ui/checkbox`
+- `@/components/ui/confirm-dialog`
+- `@/components/ui/dialog` (DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle)
+- `@/components/ui/dropdown-menu` (multiple exports)
+- `@/components/ui/input`
+- `@/components/ui/label`
+- `sonner` (toast) - **~10KB gzipped**
+
+**Data Table Primitives** (30+ imports):
+- `@/components/data-table/auto-column-widths` (computeAutoColumnPercents)
+- `@/components/data-table/columns-menu`
+- `@/components/data-table/csv-export` (exportCSV)
+- `@/components/data-table/data-table`
+- `@/components/data-table/data-table-filters`
+- `@/components/data-table/data-table-pagination`
+- `@/components/data-table/inline-edit-cell`
+- `@/components/data-table/inline-edit-cell-wrapper`
+- `@/components/data-table/resizable-draggable-header`
+- `@/components/data-table/sort-menu`
+- `@/components/data-table/status-cell-wrapper`
+- `@/components/data-table/table-utils` (stringPredicate)
+- `@/components/data-table/use-column-resize`
+- `@/components/data-table/use-saved-views`
+- `@/components/data-table/use-container-resize`
+- `@/components/data-table/view-defaults` (BaseViewConfig type)
+- `@/components/data-table/views-menu`
+
+**Form Shell Components**:
+- `@/components/forms/shell/optimistic-context` (useOptimistic)
+- `@/components/forms/shell/selection/selection-store` (useSelectionStore)
+
+**API Helpers**:
+- `@/lib/api/client-fetch` (fetchResourcePageClient)
+- `@/lib/next/search-params` (parseListParams, SPRecord)
+
+#### Client Execution Timeline
+
+```
+1. StockAdjustmentsTableClient hydration
+   â”œâ”€ useMemo(() => stockAdjustmentsViewConfig.buildColumns())
+   â”‚   â””â”€ buildColumns() execution
+   â”‚       â”œâ”€ Creates 8 column definitions
+   â”‚       â”œâ”€ Calls makeActionsColumn() (client-only)
+   â”‚       â””â”€ Returns ColumnDef[] array
+   â”‚   ~5-10ms (first render, includes JSX creation)
+   â””â”€ Render ResourceTableClient with config
+
+2. ResourceTableClient hydration
+   â”œâ”€ React hooks initialization
+   â”‚   â”œâ”€ useRouter, useSearchParams, usePathname
+   â”‚   â”œâ”€ useQueryClient (React Query)
+   â”‚   â”œâ”€ useOptimistic (context)
+   â”‚   â”œâ”€ useSelectionStore (Zustand)
+   â”‚   â””â”€ useConfirmDialog
+   â”‚   ~2-5ms
+   â”œâ”€ URL parsing (duplicate of SSR)
+   â”‚   â”œâ”€ parseListParams() re-executes
+   â”‚   â””â”€ buildExtraQueryFromFilters()
+   â”‚   ~1-2ms
+   â”œâ”€ React Query setup
+   â”‚   â”œâ”€ useQuery() with initialData from SSR
+   â”‚   â””â”€ Query key computation
+   â”‚   ~1-2ms
+   â”œâ”€ Column processing (RECOMPUTED PER RENDER)
+   â”‚   â”œâ”€ baseColumns = useMemo(() => config.columns)
+   â”‚   â”œâ”€ columnsWithHeaders = useMemo() => map decorated headers)
+   â”‚   â”œâ”€ enhancedColumns = useMemo() (adds filters, inline edits)
+   â”‚   â””â”€ selectionColumn = useMemo()
+   â”‚   ~10-20ms (if deps change)
+   â”œâ”€ Table initialization
+   â”‚   â”œâ”€ useReactTable() hook
+   â”‚   â”œâ”€ Column resize hooks (useColumnResize, useContainerResize)
+   â”‚   â”œâ”€ Saved views hook (useSavedViews)
+   â”‚   â””â”€ DnD sensors setup
+   â”‚   ~15-25ms
+   â”œâ”€ Toolbar components (memoized but computed)
+   â”‚   â”œâ”€ ColumnsAndSortToolbar
+   â”‚   â”œâ”€ MoreFiltersSection
+   â”‚   â””â”€ QuickFiltersToolbar
+   â”‚   ~5-10ms
+   â””â”€ DataTable render
+       â””â”€ TanStack Table render ~20-50ms (depends on row count)
+```
+
+**Estimated Client Hydration Time**: 60-120ms (excluding network time for any background fetches)
+
+**Total First Load Time (SSR + Hydration)**: ~120-350ms + network time
+
+---
+
+## 2. Package Classification
+
+### 2.1 SSR-Only Packages
+
+These packages are only used during server-side rendering and are NOT sent to the client:
+
+- `next` (server runtime)
+- `server-only` (if used)
+- `@supabase/ssr` (server-side Supabase client)
+- Native Node.js APIs (fs, path, etc.)
+
+### 2.2 Immediately Hydrated Packages
+
+These packages are loaded and executed during initial client hydration (first paint):
+
+**Core Libraries**:
+- `react`, `react-dom` - **~45KB gzipped**
+- `next/navigation` - **~15KB gzipped**
+- `@tanstack/react-table` - **~80KB gzipped**
+- `@tanstack/react-query` - **~50KB gzipped**
+- `@dnd-kit/core` - **~25KB gzipped**
+- `@dnd-kit/sortable` - **~15KB gzipped**
+
+**UI Libraries**:
+- `lucide-react` (icons) - **~35KB gzipped** (tree-shaken)
+- `sonner` (toasts) - **~10KB gzipped**
+- `zustand` - **~3KB gzipped**
+- Radix UI primitives (multiple, ~200KB total, tree-shaken)
+  - `@radix-ui/react-dialog`
+  - `@radix-ui/react-dropdown-menu`
+  - `@radix-ui/react-checkbox`
+  - And others...
+
+**Estimated Initial Bundle Size**: ~500-600KB gzipped (includes shared chunks)
+
+### 2.3 Interaction-Only Packages (Can Be Deferred)
+
+These packages/functions are only needed after user interaction:
+
+**Column Resizing**:
+- `use-column-resize.ts` hook
+- `use-container-resize.ts` hook
+- Resize handlers in `resizable-draggable-header.tsx`
+
+**Saved Views**:
+- `use-saved-views.ts` hook
+- `ViewsMenu` component
+- `save-view-dialog.tsx` component
+- LocalStorage API calls
+
+**Advanced Filtering**:
+- `DataTableFilters` component (More Filters section)
+- `filter-bar.tsx`
+- Filter state management
+
+**Inline Editing**:
+- `inline-edit-cell.tsx`
+- `inline-edit-cell-wrapper.tsx`
+- `StatusCellWrapper` (if status editing is used)
+
+**CSV Export**:
+- `csv-export.ts` (exportCSV function)
+- Only needed when Export button is clicked
+
+**Bulk Selection Store**:
+- `selection-store.ts` (Zustand)
+- Only needed when user selects rows
+
+**Column Reordering**:
+- DnD sensors initialization (can be lazy)
+- Column order state (can be deferred)
+
+---
+
+## 3. Performance Instrumentation Proposals
+
+### 3.1 SSR Instrumentation
+
+Add performance marks in `src/app/(main)/forms/stock-adjustments/page.tsx`:
+
+```typescript
+export default async function Page(props: { searchParams?: Promise<SPRecord> | SPRecord }) {
+  if (typeof performance !== 'undefined') {
+    performance.mark('stock-adjustments-ssr-start');
+  }
+
+  const sp = await resolveSearchParams(props.searchParams);
+  const { page, pageSize, filters } = parseListParams(sp, stockAdjustmentsFilterMeta, { defaultPage: 1, defaultPageSize: 10, max: 500 });
+
+  if (typeof performance !== 'undefined') {
+    performance.mark('stock-adjustments-ssr-params-parsed');
+  }
+
+  const extraQuery: Record<string, any> = { raw: "true" };
+  const statusFilter = filters.status;
+  if (statusFilter && statusFilter !== "ALL") {
+    Object.assign(extraQuery, statusToQuery(statusFilter));
+  }
+
+  if (typeof performance !== 'undefined') {
+    performance.mark('stock-adjustments-ssr-fetch-start');
+  }
+
+  const { rows: domainRows, total } = await fetchResourcePage<any>({
+    endpoint: config.apiEndpoint,
+    page,
+    pageSize,
+    extraQuery,
+  });
+
+  if (typeof performance !== 'undefined') {
+    performance.mark('stock-adjustments-ssr-fetch-end');
+    performance.measure('stock-adjustments-ssr-fetch', 'stock-adjustments-ssr-fetch-start', 'stock-adjustments-ssr-fetch-end');
+  }
+
+  const rows = (domainRows ?? []).map(toRow);
+
+  if (typeof performance !== 'undefined') {
+    performance.mark('stock-adjustments-ssr-transform-end');
+    performance.mark('stock-adjustments-ssr-end');
+    performance.measure('stock-adjustments-ssr-total', 'stock-adjustments-ssr-start', 'stock-adjustments-ssr-end');
+    performance.measure('stock-adjustments-ssr-params', 'stock-adjustments-ssr-start', 'stock-adjustments-ssr-params-parsed');
+    performance.measure('stock-adjustments-ssr-transform', 'stock-adjustments-ssr-fetch-end', 'stock-adjustments-ssr-transform-end');
+  }
+
+  return (
+    <PageShell>
+      <StockAdjustmentsTableClient />
+    </PageShell>
+  );
+}
+```
+
+**Logs to Capture**:
+- `stock-adjustments-ssr-total`: Total SSR time
+- `stock-adjustments-ssr-fetch`: API fetch duration
+- `stock-adjustments-ssr-transform`: Data transformation time
+- Row count, page size, filter status for context
+
+### 3.2 Client Hydration Instrumentation
+
+Add performance marks in `src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx`:
+
+```typescript
+export function StockAdjustmentsTableClient({ initialRows, initialTotal, page, pageSize }: StockAdjustmentsTableClientProps) {
+  React.useEffect(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('stock-adjustments-client-hydration-start');
+    }
+  }, []);
+
+  const viewConfigWithColumns = useMemo<BaseViewConfig<StockAdjustmentRow> & { columns?: any[] }>(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('stock-adjustments-client-columns-build-start');
+    }
+
+    const config = {
+      ...stockAdjustmentsViewConfig,
+      columns: stockAdjustmentsViewConfig.buildColumns(),
+    };
+    delete (config as any).buildColumns;
+
+    if (typeof performance !== 'undefined') {
+      performance.mark('stock-adjustments-client-columns-build-end');
+      performance.measure('stock-adjustments-client-columns-build', 'stock-adjustments-client-columns-build-start', 'stock-adjustments-client-columns-build-end');
+    }
+
+    return config;
+  }, []);
+
+  React.useEffect(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('stock-adjustments-client-hydration-end');
+      performance.measure('stock-adjustments-client-hydration', 'stock-adjustments-client-hydration-start', 'stock-adjustments-client-hydration-end');
+    }
+  }, []);
+
+  return <ResourceTableClient config={viewConfigWithColumns} ... />;
+}
+```
+
+Add performance marks in `src/components/forms/resource-view/resource-table-client.tsx`:
+
+```typescript
+export default function ResourceTableClient<TRow extends { id: string }>({ config, initialRows, ... }: ResourceTableClientProps<TRow>) {
+  React.useEffect(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('resource-table-client-init-start');
+    }
+  }, []);
+
+  // ... existing code ...
+
+  const baseColumns = React.useMemo<ColumnDef<TRow, unknown>[]>(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('resource-table-columns-process-start');
+    }
+    // ... column processing ...
+    if (typeof performance !== 'undefined') {
+      performance.mark('resource-table-columns-process-end');
+      performance.measure('resource-table-columns-process', 'resource-table-columns-process-start', 'resource-table-columns-process-end');
+    }
+    return columns;
+  }, [config]);
+
+  const table = useReactTable<TRow>({ ... });
+
+  React.useEffect(() => {
+    if (typeof performance !== 'undefined') {
+      performance.mark('resource-table-client-init-end');
+      performance.measure('resource-table-client-init', 'resource-table-client-init-start', 'resource-table-client-init-end');
+    }
+  }, []);
+
+  // ... rest of component ...
+}
+```
+
+**Logs to Capture**:
+- `stock-adjustments-client-hydration`: Total client hydration time
+- `stock-adjustments-client-columns-build`: Column definition generation
+- `resource-table-client-init`: Table initialization time
+- `resource-table-columns-process`: Column processing time
+- Initial row count, column count for context
+
+### 3.3 Measurement Collection
+
+**Server-Side**: Log performance marks via Next.js logging or custom logger:
+
+```typescript
+// In page.tsx or middleware
+if (typeof performance !== 'undefined') {
+  const measures = performance.getEntriesByType('measure');
+  console.log('[SSR Performance]', JSON.stringify(measures, null, 2));
+}
+```
+
+**Client-Side**: Send to analytics or log to console:
+
+```typescript
+// In client component useEffect
+React.useEffect(() => {
+  if (typeof performance !== 'undefined') {
+    const measures = performance.getEntriesByType('measure');
+    console.log('[Client Performance]', JSON.stringify(measures, null, 2));
+    
+    // Optionally send to analytics
+    // analytics.track('page_load_performance', { measures });
+  }
+}, []);
+```
+
+---
+
+## 4. Bundle and Chunk Audit
+
+### 4.1 Bundle Analysis Commands
+
+**Next.js Bundle Analyzer**:
+
+```bash
+# Install analyzer
+pnpm add -D @next/bundle-analyzer
+
+# Add to next.config.mjs (temporarily)
+const withBundleAnalyzer = require('@next/bundle-analyzer')({
+  enabled: process.env.ANALYZE === 'true',
+});
+
+# Run analysis
+ANALYZE=true pnpm build
+
+# Output locations:
+# - .next/analyze/client.html (browser bundle)
+# - .next/analyze/server.html (server bundle)
+```
+
+**Webpack Bundle Analyzer** (alternative):
+
+```bash
+# Install
+pnpm add -D webpack-bundle-analyzer
+
+# Run Next.js build with analyzer
+ANALYZE=true pnpm build
+
+# Or use standalone analyzer
+npx webpack-bundle-analyzer .next/static/chunks/*.js
+```
+
+**Source Map Analysis**:
+
+```bash
+# Build with source maps
+pnpm build
+
+# Analyze chunk sizes
+npx @next/bundle-analyzer .next
+
+# Or use source-map-explorer
+pnpm add -D source-map-explorer
+source-map-explorer '.next/static/chunks/*.js' --html report.html
+```
+
+### 4.2 Expected Output Locations
+
+After running `pnpm build` with analyzer:
+
+1. **Client Bundle Report**: `.next/analyze/client.html`
+   - Shows all client-side chunks
+   - Identifies large dependencies
+   - Tree-shaking effectiveness
+
+2. **Server Bundle Report**: `.next/analyze/server.html`
+   - Shows SSR-only code
+   - Identifies unnecessary server imports
+
+3. **Chunk Files**: `.next/static/chunks/`
+   - Individual chunk files with sizes
+   - Can identify code-splitting opportunities
+
+### 4.3 Likely Heavy Chunks (By File Path)
+
+**Expected Large Chunks**:
+
+1. **TanStack Table** (`@tanstack/react-table`)
+   - Location: `.next/static/chunks/node_modules_@tanstack_react-table_*.js`
+   - Estimated: ~80KB gzipped
+   - **Optimization**: Already code-split, but loaded on first paint
+
+2. **DnD Kit** (`@dnd-kit/core` + `@dnd-kit/sortable`)
+   - Location: `.next/static/chunks/node_modules_@dnd-kit_*.js`
+   - Estimated: ~40KB gzipped combined
+   - **Optimization**: Can be lazy-loaded (only needed for drag operations)
+
+3. **React Query** (`@tanstack/react-query`)
+   - Location: `.next/static/chunks/node_modules_@tanstack_react-query_*.js`
+   - Estimated: ~50KB gzipped
+   - **Optimization**: Already loaded on first paint (required for data fetching)
+
+4. **Radix UI Primitives** (multiple packages)
+   - Location: `.next/static/chunks/node_modules_@radix-ui_*.js`
+   - Estimated: ~200KB total (tree-shaken)
+   - **Optimization**: Already tree-shaken, but could lazy-load dialog components
+
+5. **Data Table Components** (local code)
+   - Location: `.next/static/chunks/src_components_data-table_*.js`
+   - Estimated: ~50-100KB (depends on usage)
+   - **Optimization**: Code-split interaction-only components
+
+6. **Lucide Icons**
+   - Location: `.next/static/chunks/node_modules_lucide-react_*.js`
+   - Estimated: ~35KB (tree-shaken)
+   - **Optimization**: Already tree-shaken, consider icon sprites for further reduction
+
+---
+
+## 5. Optimization Opportunities
+
+### 5.1 Early Wins (Low Risk, High Impact)
+
+| File Path | Change Description | Risk Level | Expected Gain |
+|-----------|-------------------|------------|---------------|
+| `src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx` | **Stabilize column memoization**: Ensure `viewConfigWithColumns` has stable deps. Currently uses empty array `[]` which is correct, but verify `buildColumns()` is pure. | Low | 5-10ms per render |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 245-252) | **Memoize `baseColumns` properly**: Currently checks `config.columns` but `config` object reference may change. Use deep comparison or extract `columns` to separate prop. | Medium | 10-20ms per render |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 512-537) | **Memoize `columnsWithHeaders` with stable deps**: Currently depends on `columnOrder` which changes. Split into base columns memo (stable) and header decoration memo (depends on order). | Medium | 10-15ms per render |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 540-619) | **Split `enhancedColumns` memoization**: Separate filter function assignment from inline edit wrapper assignment. Filter functions can be stable, inline edit wrappers depend on editing state. | Low | 5-10ms per render |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 824-834) | **Lazy-load saved views hook**: `useSavedViews` loads localStorage and makes API calls. Defer until user opens Views menu. | Low | 5-10ms initial load, ~20KB bundle |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 328-341) | **Lazy-load column resize hooks**: `useColumnResize` and `useContainerResize` only needed when user resizes. Load on first resize interaction. | Low | 3-5ms initial load, ~10KB bundle |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 281) | **Lazy-load More Filters section**: `MoreFiltersSection` is memoized but computed on every render. Lazy-load component until `showMoreFilters` is true. | Low | 2-5ms per render |
+| `src/components/data-table/csv-export.ts` | **Lazy-load CSV export**: `exportCSV` function only needed when Export button clicked. Use dynamic import in click handler. | Low | ~5KB bundle, 1-2ms initial load |
+
+### 5.2 Medium-Term Optimizations (Require Testing)
+
+| File Path | Change Description | Risk Level | Expected Gain |
+|-----------|-------------------|------------|---------------|
+| `src/components/forms/resource-view/resource-table-client.tsx` | **Code-split DnD Kit**: Lazy-load `@dnd-kit/core` and `@dnd-kit/sortable` until user attempts to drag a column. Use React.lazy() or dynamic import. | Medium | ~40KB bundle, 5-10ms initial load |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 54-55) | **Lazy-load inline edit components**: `InlineEditCellWrapper` and `StatusCellWrapper` only needed when editing. Load on first edit interaction. | Medium | ~15KB bundle, 3-5ms initial load |
+| `src/components/ui/dialog` | **Lazy-load Dialog components**: Save View dialog only needed when Save View button clicked. Use React.lazy() for DialogContent, DialogHeader, etc. | Low | ~20KB bundle, 2-3ms initial load |
+| `src/components/forms/resource-view/resource-table-client.tsx` (line 202-226) | **Optimize React Query setup**: `useQuery` runs immediately but uses `initialData`. Consider using `enabled: false` until user interacts, or reduce `staleTime` for better caching. | Low | Network request savings, faster perceived load |
+
+### 5.3 Re-computation Pattern Fixes
+
+**Issue**: Column generation runs on every render due to unstable memoization.
+
+**Current Code** (line 31-39 in `stock-adjustments-table-client.tsx`):
+```typescript
+const viewConfigWithColumns = useMemo<BaseViewConfig<StockAdjustmentRow> & { columns?: any[] }>(() => {
+  const config = {
+    ...stockAdjustmentsViewConfig,
+    columns: stockAdjustmentsViewConfig.buildColumns(),
+  };
+  delete (config as any).buildColumns;
+  return config;
+}, []); // Empty deps - good, but buildColumns() may not be pure
+```
+
+**Fix**: Ensure `buildColumns()` is pure (no side effects, same input = same output):
+- Move `buildColumns` outside component if it uses closures
+- Use `React.useMemo` inside `buildColumns` for any dynamic values
+- Consider pre-computing columns in config file (if no dynamic dependencies)
+
+**Issue**: `columnsWithHeaders` recomputes when `columnOrder` changes, but header decoration is independent of order.
+
+**Fix**: Split memoization:
+```typescript
+// Base columns (stable)
+const baseColumns = useMemo(() => config.columns, [config.columns]);
+
+// Header decoration (depends on columnOrder)
+const columnsWithHeaders = useMemo(() => {
+  return baseColumns.map((col) => {
+    // Decorate header based on columnOrder
+    return { ...col, header: decorateHeader(col, columnOrder) };
+  });
+}, [baseColumns, columnOrder]);
+```
+
+---
+
+## 6. Dependency Graph Summary
+
+### Top 10 Heaviest Modules (Estimated)
+
+Based on package.json and import analysis:
+
+1. **@tanstack/react-table** - ~80KB gzipped
+   - Used in: `resource-table-client.tsx`, `data-table.tsx`
+   - Load timing: Immediate (first paint)
+
+2. **@tanstack/react-query** - ~50KB gzipped
+   - Used in: `resource-table-client.tsx`
+   - Load timing: Immediate (first paint)
+
+3. **Radix UI Dialog** - ~30KB gzipped
+   - Used in: `resource-table-client.tsx` (Save View dialog)
+   - Load timing: Immediate (can be deferred)
+
+4. **Radix UI Dropdown Menu** - ~25KB gzipped
+   - Used in: Toolbar buttons (Columns, Sort, Views)
+   - Load timing: Immediate
+
+5. **@dnd-kit/core** - ~25KB gzipped
+   - Used in: `resource-table-client.tsx`, `data-table.tsx`
+   - Load timing: Immediate (can be deferred)
+
+6. **@dnd-kit/sortable** - ~15KB gzipped
+   - Used in: Column reordering
+   - Load timing: Immediate (can be deferred)
+
+7. **lucide-react** (tree-shaken) - ~35KB gzipped
+   - Used in: Icons throughout
+   - Load timing: Immediate
+
+8. **sonner** (toast) - ~10KB gzipped
+   - Used in: Toast notifications
+   - Load timing: Immediate
+
+9. **zustand** - ~3KB gzipped
+   - Used in: Selection store
+   - Load timing: Immediate
+
+10. **Local data-table components** - ~50-100KB (estimated)
+    - Used in: Table rendering, filters, pagination
+    - Load timing: Immediate
+
+**Total Estimated Initial Bundle**: ~500-600KB gzipped (includes shared Next.js chunks)
+
+---
+
+## 7. "Do Next" Checklist
+
+### Phase 1: Measurement (Before Changes)
+
+- [ ] Add performance instrumentation to SSR path (page.tsx)
+- [ ] Add performance instrumentation to client hydration (stock-adjustments-table-client.tsx, resource-table-client.tsx)
+- [ ] Run bundle analyzer: `ANALYZE=true pnpm build`
+- [ ] Capture baseline metrics:
+  - SSR time (server logs)
+  - Client hydration time (browser console)
+  - First Contentful Paint (FCP)
+  - Largest Contentful Paint (LCP)
+  - Time to Interactive (TTI)
+- [ ] Document baseline numbers in a follow-up report
+
+### Phase 2: Low-Risk Optimizations
+
+- [ ] Fix column memoization stability (stock-adjustments-table-client.tsx)
+- [ ] Split `columnsWithHeaders` memoization (resource-table-client.tsx)
+- [ ] Lazy-load saved views hook (useSavedViews)
+- [ ] Lazy-load column resize hooks (useColumnResize, useContainerResize)
+- [ ] Lazy-load More Filters section component
+- [ ] Lazy-load CSV export function
+- [ ] Verify all changes pass tests: `pnpm test`
+- [ ] Verify production build: `pnpm build`
+- [ ] Re-measure and compare to baseline
+
+### Phase 3: Medium-Risk Optimizations
+
+- [ ] Code-split DnD Kit (lazy-load on first drag attempt)
+- [ ] Lazy-load inline edit components (InlineEditCellWrapper, StatusCellWrapper)
+- [ ] Lazy-load Dialog components (Save View dialog)
+- [ ] Optimize React Query configuration (reduce unnecessary fetches)
+- [ ] Verify all changes pass tests: `pnpm test`
+- [ ] Verify production build: `pnpm build`
+- [ ] Run E2E smoke tests: `pnpm test:e2e:smoke`
+- [ ] Re-measure and compare to baseline
+
+### Phase 4: Bundle Analysis & Code-Splitting
+
+- [ ] Analyze bundle report for additional code-splitting opportunities
+- [ ] Identify duplicate dependencies (if any)
+- [ ] Consider dynamic imports for route-level code-splitting
+- [ ] Verify bundle size reduction in analyzer
+- [ ] Re-measure and compare to baseline
+
+### Phase 5: Documentation & Cleanup
+
+- [ ] Update this report with actual measured improvements
+- [ ] Document optimization patterns for other screens
+- [ ] Remove temporary performance instrumentation (or make it configurable)
+- [ ] Create PR with optimization summary
+
+---
+
+## 8. How to Measure Again After Changes
+
+### 8.1 Local Development
+
+**Build and analyze**:
+```bash
+# Build with analyzer
+ANALYZE=true pnpm build
+
+# Start production server
+pnpm start
+
+# Open browser DevTools â†’ Performance tab
+# Record page load for /forms/stock-adjustments
+# Check Console for performance marks
+```
+
+**Key Metrics to Capture**:
+- Performance marks (from instrumentation)
+- Network tab: Total bundle size, chunk sizes
+- Lighthouse: Performance score, FCP, LCP, TTI
+- React DevTools: Component render times
+
+### 8.2 Production Measurement
+
+**Vercel Preview**:
+- Deploy PR to Vercel preview
+- Use Vercel Analytics for real user metrics
+- Check bundle size in Vercel build logs
+
+**Web Vitals**:
+- Use `web-vitals` package (already installed) to track:
+  - FCP (First Contentful Paint)
+  - LCP (Largest Contentful Paint)
+  - FID (First Input Delay)
+  - CLS (Cumulative Layout Shift)
+  - TTFB (Time to First Byte)
+
+### 8.3 Comparison
+
+**Before/After Metrics**:
+- SSR time: Compare server logs
+- Client hydration: Compare browser console marks
+- Bundle size: Compare `.next/analyze` reports
+- Lighthouse scores: Compare performance audits
+
+**Expected Improvements** (after Phase 2 optimizations):
+- Initial bundle: -30-50KB (lazy-loaded components)
+- Client hydration: -20-40ms (fewer hooks on mount)
+- Render time: -10-20ms per render (stable memoization)
+
+---
+
+## Appendix: File Reference
+
+### Key Files Analyzed
+
+**SSR Path**:
+- `src/app/(main)/forms/stock-adjustments/page.tsx`
+- `src/lib/data/resource-fetch.ts`
+- `src/app/(main)/forms/stock-adjustments/to-row.ts`
+- `src/app/(main)/forms/stock-adjustments/stock-adjustments.config.tsx`
+
+**Client Path**:
+- `src/app/(main)/forms/stock-adjustments/stock-adjustments-table-client.tsx`
+- `src/components/forms/resource-view/resource-table-client.tsx`
+- `src/components/data-table/data-table.tsx`
+- `src/components/forms/shell/page-shell.tsx`
+
+**API Path**:
+- `src/app/api/[resource]/route.ts`
+- `src/lib/api/handle-list.ts`
+
+**Config & Types**:
+- `src/components/data-table/view-defaults.tsx`
+- `src/components/forms/shell/selection/selection-store.ts`
+- `package.json` (dependencies)
+
+---
+
+**Report Status**: Complete  
+**Next Steps**: Begin Phase 1 (Measurement) from checklist above  
+**Owner**: Development Team  
+**Review Date**: After Phase 2 optimizations completed

===== UNTRACKED FILE: src/components/data-table/use-container-resize.ts =====
diff --git a/src/components/data-table/use-container-resize.ts b/src/components/data-table/use-container-resize.ts
new file mode 100644
index 0000000..a1b2c3d
--- /dev/null
+++ b/src/components/data-table/use-container-resize.ts
@@ -0,0 +1,55 @@
+// src/components/data-table/use-container-resize.ts
+import { useEffect, useRef, useState, type RefObject, type MutableRefObject } from "react";
+
+/**
+ * Hook to track container width using ResizeObserver with throttling.
+ * Updates are throttled using requestAnimationFrame for performance.
+ */
+export function useContainerResize(
+  containerRef: RefObject<HTMLElement | null> | MutableRefObject<HTMLElement | null>,
+  enabled: boolean = true
+): number | null {
+  const [width, setWidth] = useState<number | null>(null);
+  const rafRef = useRef<number | null>(null);
+
+  useEffect(() => {
+    if (!enabled || !containerRef.current) {
+      setWidth(null);
+      return;
+    }
+
+    const element = containerRef.current;
+
+    const updateWidth = () => {
+      const newWidth = element.getBoundingClientRect().width;
+      setWidth(newWidth);
+    };
+
+    // Initial measurement
+    updateWidth();
+
+    // Throttle ResizeObserver updates using requestAnimationFrame
+    const resizeObserver = new ResizeObserver(() => {
+      if (rafRef.current !== null) {
+        cancelAnimationFrame(rafRef.current);
+      }
+      rafRef.current = requestAnimationFrame(() => {
+        updateWidth();
+        rafRef.current = null;
+      });
+    });
+
+    resizeObserver.observe(element);
+
+    return () => {
+      resizeObserver.disconnect();
+      if (rafRef.current !== null) {
+        cancelAnimationFrame(rafRef.current);
+      }
+    };
+  }, [enabled, containerRef]);
+
+  return width;
+}

===== DONE =====
docs/review/local-diffs-20251103-0816.txt

